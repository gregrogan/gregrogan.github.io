<html>
  <head>
    <link href="//vjs.zencdn.net/7.10.2/video-js.min.css" rel="stylesheet">
  </head>
  <body>
    Search <form id="search-form"><input name="q" /><input type="submit" name="submit"></form>

    <div id="video"></div>

    <ul id="vid-list"></ul>

    <script id="t-vid-list" type="text/x-jsrender">
      <li>
        <a href="#" onClick="showVid({{:id}})">{{:title}}</a>
      </li>
    </script>

    <script id="t-video" type="text/x-jsrender">
      {{:title}}
      <video class="video-js" preload="auto" poster="{{:poster}}" controls crossorigin="anonymous">
        <source src="{{:url}}" type="application/x-mpegURL">
      </video>
    </script>
    
    <script>
      window.vids = [];

      function showVid(idx) {
        $("#video").html(
          $.templates("#t-video").render(vids[idx])
        );
        videojs(document.querySelector('video'))
      }

      function renderVidList(vidList) {
        $('#vid-list').html(
          $.templates("#t-vid-list").render(vidList)
        )
      }

      document.addEventListener('DOMContentLoaded', function () {
        $.getJSON('/m/vids.json', function(data) {
          window.vids = data;
          // give each vid an ID
          window.vids.forEach((vid, i) => vid.id = i);

          renderVidList(window.vids)
        })

        $('#search-form').on('submit', function(e){
          e.preventDefault();
          var q = e.currentTarget.q.value.toLowerCase();
          if (q.trim().length == 0) {
            renderVidList(vids)
            return;
          }

          var filteredVids = $.grep(vids, function(vid){
            var title = vid.title.toLowerCase();
            return title.includes(q)
          });

          renderVidList(filteredVids)
        })
      });
    </script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jsrender/0.9.84/jsrender.min.js"></script>
    <script src="//vjs.zencdn.net/7.10.2/video.min.js"></script>
  </body>
</html>
